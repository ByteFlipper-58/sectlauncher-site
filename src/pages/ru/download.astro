---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
const GITHUB_RELEASES = 'https://github.com/byteflipper-58/sectlauncher/releases/latest';
const DOWNLOADS = {
  windows: { label: 'Windows', exts: '.exe / .msi', href: GITHUB_RELEASES },
  mac: { label: 'macOS', exts: '.dmg', href: GITHUB_RELEASES },
  linux: { label: 'Linux', exts: '.AppImage / .deb', href: GITHUB_RELEASES },
};
---

<BaseLayout title="Скачать — SectLauncher" description="Скачайте SectLauncher для Windows, macOS и Linux — современный кроссплатформенный лаунчер Minecraft.">
  <Fragment slot="header"><Header /></Fragment>
  <Fragment slot="head">
    <link rel="canonical" href="https://sectlauncher.byteflipper.com/ru/download/" />
    <link rel="alternate" hreflang="en" href="https://sectlauncher.byteflipper.com/en/download/" />
    <link rel="alternate" hreflang="x-default" href="https://sectlauncher.byteflipper.com/ru/download/" />
    <meta property="og:url" content="https://sectlauncher.byteflipper.com/ru/download/" />
  </Fragment>

  <!-- Hero секция -->
  <section class="hero-bg">
    <div class="mx-auto w-full max-w-[70%] px-4 py-16">
      <div class="text-center max-w-4xl mx-auto">
        <h1 class="text-4xl md:text-5xl font-extrabold mb-6">
          Скачать SectLauncher
        </h1>
        <p class="text-xl text-neutral-300 mb-4 leading-relaxed">
          Современный кроссплатформенный лаунчер для Minecraft с поддержкой модов и удобным интерфейсом.
        </p>
        <div class="inline-flex items-center px-4 py-2 rounded-lg bg-orange-500/20 border border-orange-500/30 mb-8">
          <svg class="w-5 h-5 mr-2 text-orange-400" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
          </svg>
          <span class="text-orange-300 font-medium">Проект находится в активной разработке</span>
        </div>
  </section>

  <Fragment slot="footer"><Footer /></Fragment>
</BaseLayout>

<script is:inline>
  // Определение ОС пользователя
  const byOS = () => {
    const ua = navigator.userAgent;
    if (/Windows/i.test(ua)) return 'windows';
    if (/Macintosh|Mac OS X/i.test(ua)) return 'mac';
    if (/Linux|X11|Ubuntu|Arch|Fedora|Debian/i.test(ua)) return 'linux';
    return 'windows';
  };

  const GITHUB_API = 'https://api.github.com/repos/byteflipper-58/sectlauncher/releases/latest';
  const FALLBACK = 'https://github.com/byteflipper-58/sectlauncher/releases/latest';
  
  const platformData = {
    windows: { 
      label: 'Windows', 
      exts: '.exe / .msi', 
      href: FALLBACK,
      icon: `<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
        <path d="M3 12V6.75l6-1.32v6.48L3 12zm17-5.25V12l-8-1.07V4.68l8 2.07zM3 13l6-.75v6.48L3 17.25V13zm17 .25L12 14.32v6.36l8-1.43V13.25z"/>
      </svg>`,
      gradient: 'from-blue-500 to-blue-600'
    },
    linux: { 
      label: 'Linux', 
      exts: '.AppImage / .deb', 
      href: FALLBACK,
      icon: `<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
        <path d="M12.504 0c-.155 0-.315.008-.48.021-4.226.333-3.105 4.807-3.17 6.298-.076 1.092-.3 1.953-1.05 3.02-.885 1.051-2.127 2.75-2.896 4.73-.769 1.98-.44 2.734.904 2.734z"/>
      </svg>`,
      gradient: 'from-orange-500 to-red-600'
    },
    mac: { 
      label: 'macOS', 
      exts: 'не поддерживается', 
      href: '#',
      icon: `<svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
        <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
      </svg>`,
      gradient: 'from-red-500 to-red-600'
    }
  };

  const os = byOS();
  const ctaLabel = document.getElementById('cta-label');
  const ctaExts = document.getElementById('cta-exts');
  const ctaLink = document.getElementById('cta-link');
  const platformIcon = document.getElementById('platform-icon');
  const versionEl = document.getElementById('version');
  
  // Инициализация интерфейса
  const data = platformData[os];
  if (data) {
    ctaLabel.textContent = data.label;
    ctaExts.textContent = data.exts;
    // Все платформы показывают статус разработки
    const ctaElement = document.querySelector('#cta .w-full');
    if (os === 'mac') {
      ctaElement.innerHTML = '<svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>К сожалению, не поддерживается';
      ctaElement.className = 'w-full inline-flex items-center justify-center px-8 py-4 rounded-xl font-semibold text-red-900 bg-gradient-to-r from-red-500 to-red-600 cursor-not-allowed';
    } else {
      ctaElement.innerHTML = '<svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>В разработке';
      ctaElement.className = 'w-full inline-flex items-center justify-center px-8 py-4 rounded-xl font-semibold text-orange-900 bg-gradient-to-r from-orange-500 to-orange-600 cursor-not-allowed';
    }
    platformIcon.innerHTML = data.icon;
    platformIcon.className = `w-12 h-12 rounded-xl bg-gradient-to-br ${data.gradient} flex items-center justify-center`;
  }

  // Функции управления интерфейсом
  function activatePane(nextOs) {
    document.querySelectorAll('#os-content [data-pane]').forEach(el => {
      el.hidden = el.getAttribute('data-pane') !== nextOs;
    });
    // Обновляем активную кнопку
    document.querySelectorAll('#os-tabs button').forEach(btn => {
      if (btn.dataset.os === nextOs) {
        btn.classList.add('bg-emerald-500', 'text-white');
        btn.classList.remove('bg-neutral-900/60', 'hover:bg-neutral-800');
      } else {
        btn.classList.remove('bg-emerald-500', 'text-white');
        btn.classList.add('bg-neutral-900/60', 'hover:bg-neutral-800');
      }
    });
  }

  function updatePlatform(nextOs) {
    const data = platformData[nextOs];
    if (!data) return;
    
    ctaLabel.textContent = data.label;
    ctaExts.textContent = data.exts;
    ctaLink.href = data.href;
    platformIcon.innerHTML = data.icon;
    platformIcon.className = `w-12 h-12 rounded-xl bg-gradient-to-br ${data.gradient} flex items-center justify-center`;
    
    activatePane(nextOs);
  }

  // Обработчик переключения платформ
  document.getElementById('os-tabs')?.addEventListener('click', (e) => {
    const btn = e.target.closest('button');
    if (!btn) return;
    const nextOs = btn.dataset.os;
    if (!nextOs) return;
    updatePlatform(nextOs);
    
    // Отслеживаем переключение платформы
    try {
      import('/src/utils/analytics.ts').then(({ trackEvent }) => {
        trackEvent('platform_switch', {
          platform: nextOs,
          event_category: 'engagement',
        });
      });
    } catch {}
  });

  // Инициализация активной панели
  activatePane(os);
  
  // Отслеживаем автоопределение ОС
  try {
    import('/src/utils/analytics.ts').then(({ trackEvent }) => {
      trackEvent('os_detected', {
        detected_os: os,
        user_agent: navigator.userAgent,
        event_category: 'system_info',
      });
    });
  } catch {}

  // Функции для работы с GitHub API
  async function pickAsset(assets, targetOs) {
    const byExt = (name, exts) => exts.some(ext => name.toLowerCase().endsWith(ext));
    if (targetOs === 'windows') {
      return assets.find(a => byExt(a.name, ['.msi'])) || assets.find(a => byExt(a.name, ['.exe']));
    }
    if (targetOs === 'mac') {
      return assets.find(a => byExt(a.name, ['.dmg']));
    }
    if (targetOs === 'linux') {
      return assets.find(a => byExt(a.name, ['.appimage'])) || assets.find(a => byExt(a.name, ['.deb']));
    }
    return null;
  }

  // Убираем загрузку релизов, так как проект в разработке
  
  // Отслеживаем клики по кнопкам скачивания
  document.addEventListener('click', async (e) => {
    const downloadBtn = e.target.closest('a[href*="github.com"], a[href*="releases"]');
    if (downloadBtn) {
      try {
        const { trackDownload } = await import('/src/utils/analytics.ts');
        const platform = document.getElementById('cta-label')?.textContent || 'unknown';
        await trackDownload(platform.toLowerCase());
      } catch {}
    }
  });
</script>

